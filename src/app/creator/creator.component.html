<div class="mainform">
  <br><br>

  <table>
    <tr>
      <td>
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Longueur</mat-label>
          <input matInput type="number" [(ngModel)]="col_width" >
        </mat-form-field>
        &nbsp;
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Hauteur</mat-label>
          <input matInput type="number" [(ngModel)]="col_height" >
        </mat-form-field>
        &nbsp;
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Nombre d'unités</mat-label>
          <input matInput type="number" [(ngModel)]="limit" >
        </mat-form-field>
      </td>
      <td>

        <button type="button" mat-raised-button mat-button
                (click)="generate_collection('upload')">
          Mettre en ligne
        </button>
        &nbsp;
        <mat-form-field style="fontsize:small">
          <mat-label>Plateforme de stockage</mat-label>
          <mat-select [(value)]="sel_platform">
            <mat-option *ngFor="let platform of platforms" [value]="platform.value">
              {{platform.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>



      </td>
    </tr>
  </table>

  <mat-expansion-panel [expanded]="show_addtext!=null">
    <mat-expansion-panel-header>Ajout de texte a {{show_addtext?.name}}</mat-expansion-panel-header>
    <table style="width: 100%;vertical-align: middle;">
      <tr>
        <td>
          <button style="width: fit-content" mat-raised-button mat-button
                  title="Ajouter une série d'identifiant"
                  (click)="add_serial(show_addtext)">
            Série numérique
          </button>
          <mat-form-field appearance="fill" style="max-width: 600px;width: 100%;">
            <mat-label>Texte a ajouter</mat-label>
            <input matInput type="text" [(ngModel)]="text_to_add" title="Insérer __idx__ pour générer des séries automatiquement">
            <mat-icon matSuffix (click)="text_to_add=''">cancel</mat-icon>
          </mat-form-field><br>

        </td>
        <td>
          <div style="width:100px;height: 100px;border: 1px solid black;cursor: crosshair;position: relative;"
               (click)="onclick_on_text($event,show_addtext)">
            <div [ngStyle]="{
              'font-size':fontsize/(col_width/100)+'px',
              position: 'absolute',display:'block',
              'z-index': 10,
              top:position_text.y+'px',left:position_text.x+'px',
              'width':'fit-content',color:color}">
              {{text_to_add.replace('__idx__','0').split("|")[0]}}
            </div>
          </div>
        </td>
        <td>
          <mat-slider [max]="200" [min]="20" [(ngModel)]="fontsize"></mat-slider>
          <br>
          <input [(colorPicker)]="color" [style.background]="color"/>
          <br><br>
          <mat-select [(ngModel)]="fontname">
            <mat-option *ngFor="let font of fontfiles" [value]="font">{{font}}</mat-option>
          </mat-select>
          <br>

        </td>
        <td>

        </td>
        <td>
          <button style="width: fit-content" mat-raised-button mat-button
                  title="Ajouter une série d'identifiant"
                  (click)="generate(show_addtext)">
            Ajouter à {{show_addtext?.name}}
          </button>

          &nbsp;

        </td>
      </tr>
    </table>
  </mat-expansion-panel>


  <mat-expansion-panel [expanded]="show_collection">
    <mat-expansion-panel-header>Collection</mat-expansion-panel-header>
    <button type="button" mat-raised-button mat-button
            (click)="generate_collection('preview')">
      Aperçu
    </button>
    <br>

    <table style="padding: 10px;width:100%;">
      <tr>
        <th>Position</th>
        <th>Nom</th>
        <th>Dimensions</th>
        <th>Commandes</th>
        <th>Contribue à l'unicité</th>
        <th>Usage unique par NFT</th>
        <th>Sélectionner une image pour la supprimer</th>
      </tr>
      <tr *ngFor="let layer of layers" style="text-align: center;vertical-align: middle">
        <td style="width: 20px;">
          <mat-icon *ngIf="layer.position>0" (click)="update_position(layer,-1)">keyboard_arrow_up</mat-icon><br>
          <mat-icon *ngIf="layer.position<layers.length-1"  (click)="update_position(layer,+1)">keyboard_arrow_down</mat-icon>
        </td>
        <td style="width:200px;">
          {{layer.name}}
        </td>
        <td>
          {{layer.width}},{{layer.height}}
        </td>
        <td style="width:320px">

          <app-upload-file (uploaded)="on_upload($event,layer)"
                           title="Chargée une image depuis votre ordinateur"
                           extensions=".png,.psd">
            <mat-icon>image</mat-icon>
          </app-upload-file>

          <button style="width: fit-content" mat-raised-button mat-button
                  title="Inclure une image sous forme d'une adresse internet"
                  (click)="add_link(layer)">
            <mat-icon>link</mat-icon>
          </button>

          <button style="width: fit-content" mat-raised-button mat-button
                  title="Inclure du texte"
                  (click)="show_addtext=layer">
            <mat-icon>notes</mat-icon>
          </button>

          <button style="width: fit-content" mat-raised-button mat-button
                  title="Effacer la ligne"
                  (click)="delete_layer(layer)">
            <mat-icon>cancel</mat-icon>
          </button>

          <button style="width: fit-content" mat-raised-button mat-button
                  title="Effacer tous les éléments"
                  (click)="clear_layer(layer)">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
        <td style="width:100px">
          <mat-checkbox style="margin-top: 10px;" [(ngModel)]="layer.indexed"></mat-checkbox>
        </td>
        <td style="width:100px">
          <mat-checkbox style="margin-top: 10px;" [(ngModel)]="layer.unique"></mat-checkbox>
        </td>
        <td style="text-align: left;">

          <div *ngFor="let file of layer.files" style="display: inline-block;margin: 5px;">
            <img *ngIf="file?.length>0"
                 [src]="file"
                 style="width: 100px;height: 100px;cursor: pointer;" class="mat-elevation-z4"
                 (click)="remove_file(layer,file)">
          </div>
        </td>
      </tr>

    </table>
    <br>
    <button type="button" mat-raised-button mat-button
            (click)="add_layer()">
      <mat-icon>add_circle</mat-icon> une couche
    </button>

    &nbsp;
    <button type="button" mat-raised-button mat-button
                   (click)="build_sample([
            {name:'carrés',files:'$appli$/assets/square1.png,$appli$/assets/square2.png,$appli$/assets/square3.png,$appli$/assets/square4.png,$appli$/assets/square5.png',text:''},
            {name:'cercles',files:'$appli$/assets/circle1.png,$appli$/assets/circle2.png,$appli$/assets/circle3.png,$appli$/assets/circle4.png,$appli$/assets/circle5.png',text:''},
            {name:'triangles',files:'$appli$/assets/triangle1.png,$appli$/assets/triangle2.png,$appli$/assets/triangle3.png',text:''},
            {name:'label',files:'',text:'NFT #1|NFT #2|NFT #3|NFT #4|NFT #5|NFT #6|NFT #7|NFT #8|NFT #9'}
          ])">
    Un exemple
  </button>

  </mat-expansion-panel>


  <!--  preview-->

  <mat-expansion-panel [expanded]="previews && previews.length>0">
    <mat-expansion-panel-header>Preview</mat-expansion-panel-header>

    <button type="button" mat-raised-button mat-button
            (click)="generate_collection('zip')">
      Télécharger
    </button>

    <mat-form-field appearance="fill" style="max-width: 200px">
      <mat-label>Nom des fichiers (__idx__ remplace l'index)</mat-label>
      <input matInput type="text" [(ngModel)]="filename_format" >
    </mat-form-field>

    <button type="button" mat-raised-button mat-button
            (click)="save_config()">
      Enregistrer la configuration
    </button>

    <br>

    <div style="width: 100%;" class="mat-elevation-z4">
      <div style="font-size:x-small;width: 100px;margin:5px;display: inline-block;text-align: center;line-height: 85%;" *ngFor="let img of previews">
        <img [src]="img.src" style="width: 100px;margin-left:5px;">
        <small>{{img.filename}}</small>
      </div>
    </div>




  </mat-expansion-panel>






  <mat-expansion-panel>
    <mat-expansion-panel-header>Configurations</mat-expansion-panel-header>

    <table>
      <tr>
        <td>
          Charger une configuration:

          <app-upload-file (uploaded)="on_upload_config($event)"
                           title="Chargée une configuration depuis votre ordinateur"
                           extensions=".yaml">
            Depuis l'ordinateur
          </app-upload-file>


          <button type="button" mat-raised-button mat-button
                  (click)="load_config()">
            Depuis le server
          </button>

          <mat-form-field style="fontsize:small">
            <mat-label>Configuration disponibles</mat-label>
            <mat-select [(value)]="sel_config">
              <mat-option *ngFor="let config of configs" [value]="config">
                {{config}}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </td>
      </tr>
    </table>






  </mat-expansion-panel>




</div>
