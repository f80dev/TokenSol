<div class="mainform">
  <br>
  <app-hourglass [message]="message"></app-hourglass>
  <br>
  <table>
    <tr>
      <td>
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Longueur</mat-label>
          <input matInput type="number" [(ngModel)]="col_width" >
        </mat-form-field>
        &nbsp;
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Hauteur</mat-label>
          <input matInput type="number" [(ngModel)]="col_height" >
        </mat-form-field>
        &nbsp;
        <mat-form-field appearance="fill" style="max-width: 100px">
          <mat-label>Nombre d'unités</mat-label>
          <input matInput type="number" [(ngModel)]="limit" >
        </mat-form-field>
      </td>
      <td>

        <button type="button" mat-raised-button mat-button
                (click)="generate_collection('upload')">
          Mettre en ligne
        </button>

        <mat-form-field style="fontsize:small">
          <mat-label>Plateforme de stockage</mat-label>
          <mat-select [(value)]="sel_platform">
            <mat-option *ngFor="let platform of platforms" [value]="platform.value">
              {{platform.label}}
            </mat-option>
          </mat-select>
        </mat-form-field>

      </td>
    </tr>
  </table>


<!--  Travail sur les textes -->
  <mat-expansion-panel [expanded]="show_addtext!=null">
    <mat-expansion-panel-header>Ajout de texte</mat-expansion-panel-header>
    <table style="width: 100%;vertical-align: middle;">
      <tr>
        <td>
          <button style="width: fit-content" mat-raised-button mat-button
                  title="Ajouter une série d'identifiant"
                  (click)="add_serial(show_addtext)">
            Série numérique
          </button>
          <mat-form-field appearance="fill" style="max-width: 600px;width: 100%;">
            <mat-label>Texte a ajouter</mat-label>
            <input matInput type="text" [(ngModel)]="text_to_add" title="Insérer __idx__ pour générer des séries automatiquement">
            <mat-icon matSuffix (click)="text_to_add=''">cancel</mat-icon>
          </mat-form-field><br>

        </td>
        <td>
          <div style="width:200px;height: 200px;border: 1px solid black;cursor: crosshair;position: relative;" [style.background-color]="backcolor"
               (click)="onclick_on_text($event,show_addtext)">
            <div [ngStyle]="{
              'font-size':fontsize/(col_width/200)+'px',
              position: 'absolute',display:'block',
              'z-index': 10,'pointer-events':'none',
              top:position_text.y*2+'px',left:position_text.x*2+'px',
              'width':'fit-content',color:color}">
              {{text_to_add.replace('__idx__','0').split("|")[0]}}
            </div>
          </div>
        </td>
        <td>
          <input [(colorPicker)]="color" [style.background]="color"><br>

          X:<mat-slider [max]="100" [thumbLabel]="true" [min]="0" [(ngModel)]="position_text.x"></mat-slider>
          <input type="number" [(ngModel)]="position_text.x" style="width:50px">
          <br>
          Y:<mat-slider [max]="100" [min]="0" [thumbLabel]="true" [(ngModel)]="position_text.y"></mat-slider>
          <input type="number" [(ngModel)]="position_text.y"  style="width:50px;">

          <br>

          <br>
          Fonte:
          <mat-select [(ngModel)]="font">
            <mat-option *ngFor="let f of fontfiles" [value]="f">{{f.name}}</mat-option>
          </mat-select>
          <br>
          FontSize: <mat-slider [max]="300" [min]="10" [thumbLabel]="true" [(ngModel)]="fontsize"></mat-slider>
          <input type="number" [(ngModel)]="fontsize"  style="width:50px;">
          <br>


        </td>
        <td>

        </td>
        <td>

        </td>
      </tr>
    </table>
  </mat-expansion-panel>



  <mat-expansion-panel [expanded]="show_collection">
    <mat-expansion-panel-header>Collection</mat-expansion-panel-header>
    <button type="button" mat-raised-button mat-button
            (click)="generate_collection('preview')">
      Aperçu
    </button>
    <button type="button" mat-raised-button mat-button
            (click)="max_items=1000">
      Voir toutes les images
    </button>
    <button type="button" mat-raised-button mat-button
            title="Afficher la transparence en noir (pour faire resortir les éléments blancs)"
            (click)="backcolor=(backcolor=='white' ? 'black' : 'white')">
      Inverser le fond
    </button>
    <br>

    <table style="padding: 10px;width:100%;">
      <tr>
        <th></th>
        <th>Nom</th>
        <th>Commandes</th>
        <th>Contribue à l'unicité</th>
        <th>Usage unique par NFT</th>
        <th>Cliquer sur une image + CTRL sur le clavier pour la supprimer</th>
      </tr>
      <tr *ngFor="let layer of layers" style="text-align: center;vertical-align: middle">
        <td style="width: 15px;">
          <mat-icon *ngIf="layer.position>0" (click)="update_position(layer,-1)">keyboard_arrow_up</mat-icon><br>
          <mat-icon *ngIf="layer.position<layers.length-1"  (click)="update_position(layer,+1)">keyboard_arrow_down</mat-icon>
        </td>
        <td style="width:fit-content;min-width: 100px;">
          {{layer.name}}
        </td>

        <td style="width:175px">
          <app-upload-file (uploaded)="on_upload($event,layer)"
                           title="Chargée une image depuis votre ordinateur"
                           extensions=".png,.psd">
            <mat-icon>image</mat-icon>
          </app-upload-file>

          <button style="width: fit-content" mat-icon-button mat-button
                  title="Inclure une image sous forme d'une adresse internet"
                  (click)="add_link(layer)">
            <mat-icon>link</mat-icon>
          </button>



          <button style="width: fit-content" mat-icon-button mat-button
                  title="Inclure du texte"
                  (click)="generate(layer)">
            <mat-icon>notes</mat-icon>
          </button>

          <button style="width: fit-content" mat-icon-button mat-button
                  title="Effacer la ligne"
                  (click)="delete_layer(layer)">
            <mat-icon>cancel</mat-icon>
          </button>

          <button style="width: fit-content" mat-icon-button mat-button
                  title="Effacer tous les éléments"
                  (click)="clear_layer(layer)">
            <mat-icon>delete</mat-icon>
          </button>

        </td>
        <td style="width:100px">
          <mat-checkbox style="margin-top: 10px;" [(ngModel)]="layer.indexed"></mat-checkbox>
        </td>
        <td style="width:100px">
          <mat-checkbox style="margin-top: 10px;" [(ngModel)]="layer.unique"></mat-checkbox>
        </td>
        <td style="text-align: left;">

          <div *ngFor="let file of layer.files.slice(0,max_items)" style="display: inline-block;margin: 5px;">
            <img *ngIf="file?.length>0"
                 [src]="file"
                 alt="En cours de chargement"
                 style="width: 100px;height: 100px;cursor: pointer;" [style.background-color]="backcolor" class="mat-elevation-z4"
                 (mousedown)="remove_file($event,layer,file)" (click)="open_file(file)">
          </div>
          <span *ngIf="max_items<1000 && layer.files.length>max_items" style="font-size: xx-large;cursor: pointer;" (click)="max_items=1000">...</span>
        </td>
      </tr>

    </table>
    <br>
    <button type="button" mat-raised-button mat-button
            (click)="add_layer()">
      <mat-icon>add_circle</mat-icon> une couche
    </button>

    <button type="button" mat-raised-button mat-button
            (click)="build_sample([
            {name:'carrés',files:'$appli$/assets/square1.png,$appli$/assets/square2.png,$appli$/assets/square3.png,$appli$/assets/square4.png,$appli$/assets/square5.png',text:''},
            {name:'cercles',files:'$appli$/assets/circle1.png,$appli$/assets/circle2.png,$appli$/assets/circle3.png,$appli$/assets/circle4.png,$appli$/assets/circle5.png',text:''},
            {name:'triangles',files:'$appli$/assets/triangle1.png,$appli$/assets/triangle2.png,$appli$/assets/triangle3.png',text:''},
            {name:'label',files:'',text:'NFT #1|NFT #2|NFT #3|NFT #4|NFT #5|NFT #6|NFT #7|NFT #8|NFT #9'}
          ])">
      Un exemple
    </button>

  </mat-expansion-panel>


  <!--  preview-->

  <mat-expansion-panel [expanded]="previews && previews.length>0">
    <mat-expansion-panel-header>Preview</mat-expansion-panel-header>

    <button type="button" mat-raised-button mat-button
            (click)="generate_collection('preview')">
      Aperçu
    </button>

    <button type="button" mat-raised-button mat-button
            (click)="generate_collection('zip')">
      Télécharger
    </button>

    <mat-form-field appearance="fill" style="max-width: 200px">
      <mat-label>Nom des fichiers</mat-label>
      <input matInput type="text" [(ngModel)]="filename_format" >
    </mat-form-field>

    <mat-form-field style="fontsize:small">
      <mat-label>Format des images</mat-label>
      <mat-select [(value)]="sel_ext">
        <mat-option value="webp">webp</mat-option>
        <mat-option value="gif">gif</mat-option>
        <mat-option value="png">png</mat-option>
      </mat-select>
    </mat-form-field>


    <button type="button" mat-raised-button mat-button
            (click)="save_config()">
      Enregistrer la configuration
    </button>

    <mat-form-field appearance="fill" style="max-width: 200px">
      <mat-label>Nom de la configuration</mat-label>
      <input matInput type="text" [(ngModel)]="config_name" >
    </mat-form-field>



    <br>

    <div style="width: 100%;" class="mat-elevation-z4">
      <div style="font-size:x-small;width: 100px;margin:5px;display: inline-block;text-align: center;line-height: 85%;" *ngFor="let img of previews">
        <img [src]="img.src" style="width: 100px;margin-left:5px;">
        <small>{{img.filename}}</small>
      </div>
    </div>

  </mat-expansion-panel>



  <mat-expansion-panel>
    <mat-expansion-panel-header>Configurations</mat-expansion-panel-header>


    <table>
      <tr>
        <td>
          Charger une configuration:

          <app-upload-file (uploaded)="on_upload_config($event)"
                           title="Chargée une configuration depuis votre ordinateur"
                           extensions=".yaml">
            Depuis l'ordinateur
          </app-upload-file>


          <mat-form-field style="fontsize:small">
            <mat-label>Configuration disponibles</mat-label>
            <mat-select [(value)]="sel_config" (selectionChange)="load_config(sel_config)">
              <mat-option *ngFor="let config of configs" [value]="config">
                {{config}}
              </mat-option>
            </mat-select>
          </mat-form-field>

        </td>
      </tr>
    </table>

  </mat-expansion-panel>




</div>
