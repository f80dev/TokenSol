<div class="mainform">

    une <strong>opération</strong> est un fichier regroupant
    <ul>
      <li>la liste des wallets utilisés pour le minage et comme créateur des nfts </li>
      <li>la liste des validateurs (adresses mails)</li>
      <li>le processus de validation</li>
      <li>le processus de génération automatique des NFTs (en construction)</li>
      <li>le processus de distribution 'libre-service' des NFTs (en construction)</li>
    </ul>

  <table>
    <tr>
    <td>
      Créer une nouvelle opération<br>
      <a href="./assets/new_operation.yaml" download>Télécharger le modèle</a>

      </td>
    <td>
      Importer une opération<br>depuis votre poste<br>
      <app-upload-file (uploaded)="upload_operation($event)"
                       title="Ajouter une opération"
                       style="margin: 10px"
                       extensions=".yaml">
        Importer
      </app-upload-file>
      <br>
    </td>
    <td>
      <button type="button" mat-raised-button mat-button (click)="delete_ope()">
        Supprimer
      </button>
    </td>
    <td>
      <mat-form-field appearance="fill" style="width:300px;" *ngIf="url_ope==''">
        <mat-label>Sélectionner une opération hébergée sur le serveur</mat-label>
        <mat-select [(value)]="sel_ope" (selectionChange)="refresh_ope($event)" >
          <mat-option *ngFor="let ope of opes" [value]="ope">
            {{ope.title}}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix (click)="sel_ope=null;">cancel</mat-icon>
      </mat-form-field>
      /
      <mat-form-field appearance="fill" style="width:300px;">
        <mat-label>Utiliser une operation depuis un lien web</mat-label>
        <input matInput type="url" [(ngModel)]="url_ope" (ngModelChange)="update_url_ope($event)">
        <mat-icon matSuffix (click)="url_ope=''">cancel</mat-icon>
      </mat-form-field>
    </td>
  </tr></table>

  <div *ngIf="sel_ope">
    <h1>{{sel_ope.title}}</h1>
    <small>{{sel_ope.description}}</small>

    <table style="line-height: 85%;">
      <tr>
        <td>network:</td><td>{{sel_ope.network}}</td>
      </tr>
      <tr>
        <td>version:</td><td>{{sel_ope.version}}</td>
      </tr>
    </table>



    <div *ngIf="sel_ope.lottery.visible" style="padding: 10px" class="mat-elevation-z4">
      Loterie<br>
      <table>
        <tr>
          <td style="text-align: left;">
            Page complète: <a [href]="sel_ope.lottery.application" target="same">{{sel_ope.lottery.application}}</a><br>
            Iframe: {{sel_ope.lottery.iframe_code}}<br>
            QRCode: {{sel_ope.lottery.image_code}}
          </td>
        </tr>
      </table>
    </div>
    <br>
    <div *ngIf="sel_ope.validate.visible || url_ope.length>0" style="padding: 10px" class="mat-elevation-z4">
      Validation
      <table>
        <tr style="vertical-align: top;">
          <td style="text-align: left;" *ngIf="sel_ope.validate?.users">
            Propriétés visibles du validateurs:
            <ul>
              <li *ngFor="let prop of sel_ope.validate.properties">
                {{prop}}
              </li>
            </ul>
          </td>
          <td style="text-align: left;" *ngIf="sel_ope.validate?.users">
            Liste des validateurs autorisés
            <ul>
              <li *ngFor="let user of sel_ope.validate.users">
                <mat-icon (click)="send_mail(user)"
                          style="cursor: pointer;font-size: medium;"
                          [title]="'notifier '+user">notifications</mat-icon>
                {{user}}
              </li>
            </ul>
            <button type="button" mat-raised-button mat-button (click)="send_mail()">
              Tous les notifier
            </button>
          </td>

          <td>
            Voir l'application de validation<br>
            <a [href]="sel_ope.validate.application" target="_self">Ouvrir</a>
            <br>
            <a [href]="sel_ope.validate.application+'&toolbar=false'" target="_self">Sans menu</a>
          </td>
        </tr>
      </table>
    </div>
  </div>

</div>
